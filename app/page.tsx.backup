"use client"

import { useEffect, useState } from "react"
import { ChevronDown } from "lucide-react"

// Year data with verified statistics
const yearData = {
  1967: { lakes: 3000, percent: 100, lost: 0 },
  1979: { lakes: 2800, percent: 95, lost: 200 },
  1989: { lakes: 2500, percent: 85, lost: 500 },
  2001: { lakes: 2000, percent: 70, lost: 1000 },
  2006: { lakes: 1500, percent: 55, lost: 1500 },
  2013: { lakes: 1000, percent: 40, lost: 2000 },
  2014: { lakes: 900, percent: 37, lost: 2100 },
  2020: { lakes: 500, percent: 30, lost: 2500 },
  2021: { lakes: 400, percent: 27, lost: 2600 },
  2023: { lakes: 300, percent: 25, lost: 2700 },
  2024: { lakes: 250, percent: 23.3, lost: 2750 },
}

interface EventCardProps {
  category: string
  categoryClass: string
  title: string
  summary: string
  details: Array<{
    label: string
    content: string
  }>
}

function EventCard({ category, categoryClass, title, summary, details }: EventCardProps) {
  const [isExpanded, setIsExpanded] = useState(false)

  return (
    <div
      className={`bg-[#2a3040]/80 border border-[#3d4354] rounded-xl p-8 cursor-pointer transition-all duration-300 relative overflow-hidden hover:bg-[#2a3040] hover:border-[#e05d38]/50 hover:-translate-y-0.5 hover:shadow-[0_10px_30px_rgba(0,0,0,0.5)] ${isExpanded ? "bg-[#2a3040] border-[#e05d38]" : ""}`}
      onClick={() => setIsExpanded(!isExpanded)}
    >
      <div className="flex justify-between items-start mb-4">
        <span
          className={`text-xs uppercase tracking-wider px-3 py-1.5 bg-[#2a303e]/60 rounded-full inline-block font-medium ${categoryClass}`}
        >
          {category}
        </span>
      </div>

      <h3 className="text-2xl font-semibold mb-2 leading-tight">{title}</h3>
      <p className="text-base opacity-80 leading-relaxed">{summary}</p>

      {isExpanded && (
        <div className="mt-6 pt-6 border-t border-[#3d4354]">
          {details.map((detail, index) => (
            <div key={index} className="mb-4">
              <div className="text-sm font-semibold opacity-70 mb-1 uppercase tracking-wider">{detail.label}</div>
              <div
                className="text-sm opacity-90 leading-relaxed"
                dangerouslySetInnerHTML={{ __html: detail.content }}
              />
            </div>
          ))}
        </div>
      )}

      <ChevronDown
        className={`absolute right-6 bottom-6 w-6 h-6 opacity-30 transition-all duration-300 hover:opacity-60 ${isExpanded ? "rotate-180" : ""}`}
      />
    </div>
  )
}

interface YearSectionProps {
  year: number
  era: string
  eraLabel: string
  lakes: number
  stats: Array<{
    value: string
    label: string
    change: string
  }>
  events: EventCardProps[]
}

function YearSection({ year, era, eraLabel, lakes, stats, events }: YearSectionProps) {
  return (
    <section
      className={`min-h-screen flex items-center relative py-16 px-8 opacity-100 transition-opacity duration-700 ${era}`}
      data-year={year}
      data-lakes={lakes}
    >
      <div className="max-w-7xl w-full mx-auto grid grid-cols-1 lg:grid-cols-3 gap-16 items-start">
        <div className="lg:sticky lg:top-[20vh]">
          <div className="text-sm uppercase tracking-wider opacity-50 mb-2">{eraLabel}</div>
          <div className="text-6xl md:text-8xl font-black leading-none mb-6 font-mono">{year}</div>
          <div className="flex flex-col gap-6">
            {stats.map((stat, index) => (
              <div key={index} className="border-l-3 border-current pl-4">
                <div className="text-2xl md:text-3xl font-bold mb-1">{stat.value}</div>
                <div className="text-sm opacity-70 uppercase tracking-wider">{stat.label}</div>
                <div className="text-sm opacity-60 mt-1">{stat.change}</div>
              </div>
            ))}
          </div>
        </div>

        <div className="lg:col-span-2 flex flex-col gap-6">
          {events.map((event, index) => (
            <EventCard key={index} {...event} />
          ))}
        </div>
      </div>
    </section>
  )
}

export default function HyderabadLakesStory() {
  const [scrollProgress, setScrollProgress] = useState(0)
  const [currentYear, setCurrentYear] = useState(1967)
  const [lakesLost, setLakesLost] = useState(0)
  const [waterPercent, setWaterPercent] = useState(100)

  useEffect(() => {
    const handleScroll = () => {
      const scrolled = window.pageYOffset
      const maxScroll = document.documentElement.scrollHeight - window.innerHeight
      const scrollPercent = scrolled / maxScroll

      setScrollProgress(scrollPercent)

      // Update water level (100% to 23.3%)
      const waterHeight = 100 - scrollPercent * 76.7
      setWaterPercent(Math.max(waterHeight, 23.3))

      // Find current year section
      const yearSections = document.querySelectorAll("[data-year]")
      let newCurrentYear = 1967
      let newLakesLost = 0

      yearSections.forEach((section) => {
        const rect = section.getBoundingClientRect()
        if (rect.top < window.innerHeight / 2 && rect.bottom > 0) {
          const year = Number.parseInt(section.getAttribute("data-year") || "1967")
          const data = yearData[year as keyof typeof yearData]
          if (data) {
            newCurrentYear = year
            newLakesLost = data.lost
          }
        }
      })

      setCurrentYear(newCurrentYear)
      setLakesLost(newLakesLost)
    }

    window.addEventListener("scroll", handleScroll)
    return () => window.removeEventListener("scroll", handleScroll)
  }, [])

  const scrollToTimeline = () => {
    document.getElementById("timeline")?.scrollIntoView({ behavior: "smooth" })
  }

  return (
    <div className="bg-[#1c2433] text-[#e5e5e5] overflow-x-hidden">
      {/* Progress Bar */}
      <div
        className="fixed left-0 top-0 h-1 bg-gradient-to-r from-[#86a7c8] via-[#e05d38] via-[#ef4444] to-[#ef4444] z-50 transition-all duration-300"
        style={{ width: `${scrollProgress * 100}%` }}
      />

      {/* Fixed Stats Display */}
      <div className="fixed top-5 left-5 bg-[#2a3040]/95 p-6 rounded-xl backdrop-blur-md z-40 border border-[#3d4354]">
        <div className="mb-4">
          <div className="text-xs opacity-60 uppercase tracking-wider mb-1">Lakes Lost</div>
          <div className="text-3xl font-bold font-mono">{lakesLost.toLocaleString()}</div>
        </div>
        <div>
          <div className="text-xs opacity-60 uppercase tracking-wider mb-1">Year</div>
          <div className="text-3xl font-bold font-mono">{currentYear}</div>
        </div>
      </div>

      {/* Water Level Visualization */}
      <div className="fixed right-0 top-0 bottom-0 w-32 md:w-48 bg-gradient-to-b from-[#2a3656]/30 to-[#1c2433] z-30 overflow-hidden border-l border-[#3d4354]">
        <div className="absolute top-5 left-5 right-5 text-center z-40">
          <div className="text-2xl md:text-4xl font-black font-mono mb-2">{Math.round(waterPercent)}%</div>
          <div className="text-xs uppercase tracking-wider opacity-70">Water Capacity</div>
        </div>
        <div
          className="absolute top-0 left-0 right-0 bg-gradient-to-b from-[#86a7c8] via-[#5a7ca6] to-[#466494] transition-all duration-500 relative overflow-hidden"
          style={{ height: `${100 - waterPercent}%` }}
        >
          <div className="absolute bottom-0 left-0 right-0 h-5 bg-gradient-to-t from-white/20 to-transparent animate-[wave_3s_ease-in-out_infinite]" />
        </div>
      </div>

      {/* Hero Section */}
      <section className="h-screen flex flex-col justify-center items-center text-center bg-gradient-to-br from-[#2a3656]/40 to-[#1c2433] relative px-8">
        <h1 className="text-4xl md:text-8xl font-black mb-4 leading-none tracking-tight">
          50+ Years of Vanishing Water
        </h1>
        <p className="text-xl md:text-2xl opacity-60 mb-8 font-light max-w-4xl">
          A data-driven chronicle of Hyderabad's environmental catastrophe
        </p>
        <div className="flex flex-col md:flex-row gap-8 md:gap-16 mt-12 opacity-0 animate-[fadeInUp_1s_ease_0.5s_forwards]">
          <div className="text-center">
            <div className="text-3xl md:text-5xl font-black text-green-500 font-mono">3,000-7,000</div>
            <div className="text-sm opacity-70 uppercase tracking-wider">Historical Water Bodies</div>
          </div>
          <div className="text-center">
            <div className="text-3xl md:text-5xl font-black text-red-500 font-mono">61%</div>
            <div className="text-sm opacity-70 uppercase tracking-wider">Area Lost (1979-2024)</div>
          </div>
          <div className="text-center">
            <div className="text-3xl md:text-5xl font-black text-orange-500 font-mono">70-500</div>
            <div className="text-sm opacity-70 uppercase tracking-wider">Remain Today</div>
          </div>
        </div>
        <button
          onClick={scrollToTimeline}
          className="absolute bottom-8 text-4xl opacity-50 animate-bounce cursor-pointer hover:opacity-70 transition-opacity"
        >
          â†“
        </button>
      </section>

      {/* Timeline Container */}
      <div id="timeline" className="relative w-full bg-[#1c2433]">
        <YearSection
          year={1967}
          era="era-stable text-green-500"
          eraLabel="Historical Baseline"
          lakes={3000}
          stats={[{ value: "3,000-7,000", label: "Water Bodies", change: "Corona satellite baseline" }]}
          events={[
            {
              category: "Satellite Era",
              categoryClass: "bg-cyan-500/20",
              title: "Corona Program Documents Hyderabad",
              summary:
                "Declassified U.S. reconnaissance satellite imagery provides the first comprehensive aerial view of Hyderabad's water bodies, establishing a crucial baseline for future comparisons.",
              details: [
                {
                  label: "Data Source",
                  content: "Corona Program satellite imagery, now available through NARA and USGS EROS Center",
                },
                {
                  label: "Significance",
                  content:
                    "This imagery would later be used by World Resources Institute (India) to measure lake shrinkage over 54 years",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={1979}
          era="era-stable text-green-500"
          eraLabel="Official Baseline"
          lakes={2800}
          stats={[{ value: "40.35 sq km", label: "Total Lake Area", change: "NRSC measurement baseline" }]}
          events={[
            {
              category: "Scientific Documentation",
              categoryClass: "bg-gray-500/20",
              title: "NRSC Establishes Lake Baseline",
              summary:
                "National Remote Sensing Centre (NRSC) conducts comprehensive satellite survey of Hyderabad's lakes, documenting 40.35 sq km of water bodies. This becomes the official baseline for measuring future losses.",
              details: [
                {
                  label: "Methodology",
                  content: "Using satellite imagery, NRSC mapped 56 major lakes across Hyderabad region",
                },
                {
                  label: "Future Use",
                  content:
                    "This data would be referenced 45 years later by NRSC Director Prakash Chauhan to show 61% reduction",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={1989}
          era="era-warning text-yellow-500"
          eraLabel="Early Warning"
          lakes={2500}
          stats={[
            { value: "486 hectares", label: "Shamirpet Lake", change: "Key measurement year" },
            { value: "~800", label: "Major Lakes", change: "Pre-IT boom count" },
          ]}
          events={[
            {
              category: "Lake Study",
              categoryClass: "bg-gray-500/20",
              title: "Shamirpet Lake Documented at Full Capacity",
              summary:
                "Shamirpet Lake measured at 486 hectares, serving as a reference point for future degradation studies. The city still has approximately 800 major lakes functioning.",
              details: [
                {
                  label: "Context",
                  content: "This measurement would later show 47% reduction by 2006, highlighting rapid degradation",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2001}
          era="era-critical text-orange-500"
          eraLabel="Accelerating Loss"
          lakes={2000}
          stats={[{ value: "3,245 hectares", label: "Lake Area Lost", change: "Since 1989 (12 years)" }]}
          events={[
            {
              category: "Academic Study",
              categoryClass: "bg-gray-500/20",
              title: "Research Confirms Massive Lake Loss",
              summary:
                "Academic studies document loss of 3,245 hectares of lake area between 1989-2001, a period coinciding with Hyderabad's IT boom and rapid urbanization.",
              details: [
                {
                  label: "Rate of Loss",
                  content: "270 hectares per year average, equivalent to losing one medium-sized lake every month",
                },
                {
                  label: "Primary Cause",
                  content: "Urbanization and land appropriation for IT infrastructure and housing",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2006}
          era="era-critical text-orange-500"
          eraLabel="Documented Decline"
          lakes={1500}
          stats={[{ value: "256 hectares", label: "Shamirpet Lake", change: "47% reduction from 1989" }]}
          events={[
            {
              category: "Case Study",
              categoryClass: "bg-red-500/20",
              title: "Shamirpet Lake Loses Half Its Area",
              summary:
                "From 486 hectares in 1989 to just 256 hectares - Shamirpet Lake exemplifies the citywide crisis, having lost 47% of its area in just 17 years.",
              details: [
                {
                  label: "Pattern",
                  content:
                    "Similar reductions observed across major lakes: encroachment, pollution, and disrupted inflows",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2013}
          era="era-crisis text-red-400"
          eraLabel="Belated Response"
          lakes={1000}
          stats={[{ value: "185", label: "Notified Lakes", change: "In GHMC limits" }]}
          events={[
            {
              category: "Government Action",
              categoryClass: "bg-purple-500/20",
              title: "Lake Protection Committee Survey Initiated",
              summary:
                "Government finally initiates comprehensive lake survey through Lake Protection Committee. Only 185 lakes identified for protection in GHMC limits - a fraction of historical numbers.",
              details: [
                {
                  label: "Too Little, Too Late",
                  content: "By the time protection measures begin, thousands of water bodies have already vanished",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2014}
          era="era-crisis text-red-400"
          eraLabel="New State, Old Problems"
          lakes={900}
          stats={[{ value: "New State", label: "Telangana Formed", change: "June 2, 2014" }]}
          events={[
            {
              category: "Political Change",
              categoryClass: "bg-purple-500/20",
              title: "Telangana State Formation",
              summary:
                "New state of Telangana formed with Hyderabad as capital. Lake restoration becomes a stated priority, but encroachments continue unabated.",
              details: [
                {
                  label: "New Initiatives",
                  content: "Mission Kakatiya launched for tank restoration, but urban lakes remain under pressure",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2020}
          era="era-emergency text-red-600"
          eraLabel="Crisis Point"
          lakes={500}
          stats={[
            { value: "30cm rainfall", label: "Oct 13-14", change: "Nallagandla floods" },
            { value: "3 deaths", label: "Flood casualties", change: "Preventable tragedy" },
          ]}
          events={[
            {
              category: "Disaster",
              categoryClass: "bg-blue-500/20",
              title: "Nallagandla Flood Tragedy",
              summary:
                "October 13-14: 30cm rainfall causes devastating floods in Nallagandla area, resulting in 3 deaths. The tragedy highlights how lake encroachments have destroyed natural drainage.",
              details: [
                {
                  label: "Root Cause",
                  content:
                    "Area developed on former lake beds and water channels, leaving nowhere for excess water to flow",
                },
                {
                  label: "Expert Analysis",
                  content:
                    "Dr. Parth Sarathi Roy documents how 77% decline in lakes directly contributed to flood severity",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2021}
          era="era-emergency text-red-600"
          eraLabel="Evidence Mounts"
          lakes={400}
          stats={[{ value: "Up to 83%", label: "Lake Shrinkage", change: "Since 1967" }]}
          events={[
            {
              category: "Major Study",
              categoryClass: "bg-gray-500/20",
              title: "WRI Satellite Analysis Reveals Shocking Loss",
              summary:
                "World Resources Institute (India) with The News Minute publishes satellite image analysis showing individual lakes have shrunk by up to 83% since 1967.",
              details: [
                {
                  label: "Key Findings",
                  content:
                    "â€¢ Ramanthapur Cheruvu: 83% reduction<br>â€¢ Shah Hatim Talab: 58% reduction<br>â€¢ Gurram Cheruvu: 55% reduction<br>â€¢ Mir Alam Tank: 23% reduction<br>â€¢ Durgam Cheruvu: 15% reduction",
                },
                {
                  label: "Methodology",
                  content: "Compared 1967 Corona Program imagery with 2021 Google Earth/Maxar satellite data",
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2023}
          era="era-emergency text-red-600"
          eraLabel="Expert Alarms"
          lakes={300}
          stats={[{ value: "30-40", label: "Lakes Dried Up", change: "PCB report" }]}
          events={[
            {
              category: "Expert Warning",
              categoryClass: "bg-red-500/20",
              title: "Experts Stress Urgent Rejuvenation Need",
              summary:
                "Pollution Control Board reports 30-40 of 185 notified lakes have completely dried up. Experts like Priyanka Pugaokar (CSE) warn of climate resilience crisis.",
              details: [
                {
                  label: "Dried Lakes Include",
                  content:
                    "Pedda Cheruvu (Meerpet), Nalla Cheruvu (Uppal), Safilguda Lake, Chilakanagar Lake, and many others now exist only in revenue records",
                },
                {
                  label: "Climate Impact",
                  content:
                    '"Reviving urban water bodies is crucial for building the city\'s resilience to climate change" - Priyanka Pugaokar, CSE',
                },
              ],
            },
          ]}
        />

        <YearSection
          year={2024}
          era="era-emergency text-red-600"
          eraLabel="Present Reality"
          lakes={250}
          stats={[
            { value: "16 sq km", label: "Total Lake Area", change: "61% loss from 1979" },
            { value: "70-500", label: "Lakes Remain", change: "From 3,000-7,000" },
          ]}
          events={[
            {
              category: "Scientific Proof",
              categoryClass: "bg-gray-500/20",
              title: "NRSC Confirms 61% Lake Area Loss",
              summary:
                "NRSC Director Prakash Chauhan presents satellite data showing Hyderabad's lake area shrunk from 40.35 sq km (1979) to just 16 sq km (2024) - a devastating 61% reduction.",
              details: [
                {
                  label: "Study Details",
                  content:
                    "56 lakes examined using 45 years of satellite data. 40 lakes (75%) have shrunk by more than half",
                },
                {
                  label: "Economic Impact",
                  content: "Estimated annual loss of $30.44 million (â‚¹2,494 crores) due to lake degradation",
                },
              ],
            },
            {
              category: "Enforcement",
              categoryClass: "bg-purple-500/20",
              title: "HYDRAA Established for Lake Protection",
              summary:
                "July 19: Hyderabad Disaster Response and Asset Protection Agency (HYDRAA) created with â‚¹200 crores budget. Commissioner Avula Venkata Ranganath leads demolition drives.",
              details: [
                {
                  label: "Actions Taken",
                  content:
                    "â€¢ 52 illegal structures demolished<br>â€¢ 119 acres reclaimed<br>â€¢ Using NRSA satellite data and virtual fencing<br>â€¢ 60-80% of ponds still occupied by illegal structures",
                },
                {
                  label: "Three-Phase Approach",
                  content:
                    "1. Stop further invasions<br>2. Deny permissions for illegal buildings<br>3. Remove silt, divert rainwater, restore water bodies",
                },
              ],
            },
            {
              category: "Hope Through Data",
              categoryClass: "bg-green-500/20",
              title: "This Research Project",
              summary:
                '"Reviving Hyderabad\'s Lost Lakes: A Data-Driven Chronicle and Visualization Platform" - The first comprehensive attempt to document every water body and make the crisis emotionally accessible.',
              details: [
                {
                  label: "Project Goals",
                  content:
                    "â€¢ Document all water bodies (1975-2025)<br>â€¢ Create India's first lake tracking platform<br>â€¢ Combine satellite data with ground truth<br>â€¢ Make data emotionally compelling for action",
                },
                {
                  label: "Why This Matters",
                  content:
                    "Without accurate data and public awareness, we cannot protect what remains. Every lake saved means better flood protection and a chance for future generations.",
                },
              ],
            },
          ]}
        />
      </div>

      <style jsx>{`
        @keyframes fadeInUp {
          0% { opacity: 0; transform: translateY(20px); }
          100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes wave {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-5px); }
        }
        .border-l-3 {
          border-left-width: 3px;
        }
        .era-stable { --era-color: #86a7c8; }
        .era-warning { --era-color: #e6a08f; }
        .era-critical { --era-color: #e05d38; }
        .era-crisis { --era-color: #ef4444; }
        .era-emergency { --era-color: #ef4444; }
      `}</style>
    </div>
  )
}
